# ğŸ’¬ ì¹´ì¹´ì˜¤í†¡ ì±—ë´‡ ì—°ë™ ê°€ì´ë“œ

Soccer Match Managerì˜ ë°ì´í„°ë¥¼ ì¹´ì¹´ì˜¤í†¡ ì±—ë´‡ì„ í†µí•´ ì¡°íšŒí•˜ëŠ” ë°©ë²•ì…ë‹ˆë‹¤.

---

## ğŸ“š ëª©ì°¨

1. [ê°œìš”](#ê°œìš”)
2. [ì¹´ì¹´ì˜¤í†¡ ì±—ë´‡ ì•„í‚¤í…ì²˜](#ì¹´ì¹´ì˜¤í†¡-ì±—ë´‡-ì•„í‚¤í…ì²˜)
3. [ì¹´ì¹´ì˜¤ ì±„ë„ & ì±—ë´‡ ìƒì„±](#ì¹´ì¹´ì˜¤-ì±„ë„--ì±—ë´‡-ìƒì„±)
4. [ì±—ë´‡ ì„œë²„ êµ¬ì¶•](#ì±—ë´‡-ì„œë²„-êµ¬ì¶•)
5. [ì‹œë‚˜ë¦¬ì˜¤ êµ¬ì„±](#ì‹œë‚˜ë¦¬ì˜¤-êµ¬ì„±)
6. [ë°°í¬ ë° í…ŒìŠ¤íŠ¸](#ë°°í¬-ë°-í…ŒìŠ¤íŠ¸)

---

## ğŸ“– ê°œìš”

### ì¹´ì¹´ì˜¤í†¡ ì±—ë´‡ìœ¼ë¡œ í•  ìˆ˜ ìˆëŠ” ê²ƒ

- âš½ **ë‹¤ìŒ ê²½ê¸° ì¡°íšŒ**: "ë‹¤ìŒ ê²½ê¸° ì–¸ì œì•¼?"
- ğŸ† **ìµœê·¼ ê²½ê¸° ê²°ê³¼**: "ì§€ë‚œ ê²½ê¸° ê²°ê³¼ ì•Œë ¤ì¤˜"
- ğŸ“Š **ê°œì¸ í†µê³„ ì¡°íšŒ**: "ë‚´ í†µê³„ ë³´ì—¬ì¤˜"
- ğŸ‘¥ **íŒ€ ìˆœìœ„**: "íŒ€ ìˆœìœ„ ì•Œë ¤ì¤˜"
- ğŸ¯ **ë“ì ì™•**: "ë“ì ì™• ëˆ„êµ¬ì•¼?"
- âœ… **ì¶œì„ í™•ì¸**: "ë‹¤ìŒ ê²½ê¸° ì¶œì„í• ê²Œ"
- ğŸ“¢ **ê³µì§€ì‚¬í•­**: "ìµœê·¼ ê³µì§€ì‚¬í•­ ë³´ì—¬ì¤˜"

---

## ğŸ— ì¹´ì¹´ì˜¤í†¡ ì±—ë´‡ ì•„í‚¤í…ì²˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ì¹´ì¹´ì˜¤í†¡ ì•±  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚ ì‚¬ìš©ì ë©”ì‹œì§€
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ì¹´ì¹´ì˜¤ i ì˜¤í”ˆë¹Œë” â”‚ (ì‹œë‚˜ë¦¬ì˜¤ ê´€ë¦¬)
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ Webhook
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ì±—ë´‡ ì„œë²„ (NEW) â”‚ â† ìš°ë¦¬ê°€ ë§Œë“¤ ì„œë²„
â”‚  /webhook        â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ API í˜¸ì¶œ
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ê¸°ì¡´ ë°±ì—”ë“œ API  â”‚ (Firebase + Cloud Run)
â”‚ /api/matches     â”‚
â”‚ /api/statistics  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¯ ì¹´ì¹´ì˜¤ ì±„ë„ & ì±—ë´‡ ìƒì„±

### 1. ì¹´ì¹´ì˜¤ ë¹„ì¦ˆë‹ˆìŠ¤ ê³„ì • ìƒì„±

1. **ì¹´ì¹´ì˜¤ ë¹„ì¦ˆë‹ˆìŠ¤** ì ‘ì†: https://business.kakao.com
2. **ì¹´ì¹´ì˜¤ ì±„ë„ ë§Œë“¤ê¸°**
   - ì±„ë„ ì´ë¦„: "ì¶•êµ¬íŒ€ ë§¤ë‹ˆì €" (ì›í•˜ëŠ” ì´ë¦„)
   - ê²€ìƒ‰ìš© ID: `@soccer_manager`
   - ì¹´í…Œê³ ë¦¬: ìŠ¤í¬ì¸ /ë ˆì €

### 2. ì¹´ì¹´ì˜¤ i ì˜¤í”ˆë¹Œë” ì„¤ì •

1. **ì˜¤í”ˆë¹Œë”** ì ‘ì†: https://i.kakao.com
2. **ìƒˆ ì±—ë´‡ ë§Œë“¤ê¸°**
   - ë´‡ ì´ë¦„: "ì¶•êµ¬íŒ€ ë§¤ë‹ˆì € ë´‡"
   - ì¹´ì¹´ì˜¤ ì±„ë„ ì—°ê²°
3. **ìŠ¤í‚¬ ì„œë²„ ë“±ë¡**
   - URL: `https://your-chatbot-server.run.app/webhook`

---

## ğŸ›  ì±—ë´‡ ì„œë²„ êµ¬ì¶•

### í”„ë¡œì íŠ¸ êµ¬ì¡°

```
chatbot/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ index.ts              # Express ì„œë²„
â”‚   â”œâ”€â”€ handlers/
â”‚   â”‚   â”œâ”€â”€ matchHandler.ts   # ê²½ê¸° ê´€ë ¨ í•¸ë“¤ëŸ¬
â”‚   â”‚   â”œâ”€â”€ statsHandler.ts   # í†µê³„ ê´€ë ¨ í•¸ë“¤ëŸ¬
â”‚   â”‚   â”œâ”€â”€ noticeHandler.ts  # ê³µì§€ì‚¬í•­ í•¸ë“¤ëŸ¬
â”‚   â”‚   â””â”€â”€ helpHandler.ts    # ë„ì›€ë§ í•¸ë“¤ëŸ¬
â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â””â”€â”€ apiService.ts     # ë°±ì—”ë“œ API í˜¸ì¶œ
â”‚   â”œâ”€â”€ utils/
â”‚   â”‚   â”œâ”€â”€ formatter.ts      # ë©”ì‹œì§€ í¬ë§·íŒ…
â”‚   â”‚   â””â”€â”€ validator.ts      # ì…ë ¥ ê²€ì¦
â”‚   â””â”€â”€ types/
â”‚       â””â”€â”€ kakao.ts          # ì¹´ì¹´ì˜¤ íƒ€ì… ì •ì˜
â”œâ”€â”€ Dockerfile
â”œâ”€â”€ package.json
â””â”€â”€ tsconfig.json
```

### ì±—ë´‡ ì„œë²„ ì½”ë“œ

#### 1. ë©”ì¸ ì„œë²„ (`chatbot/src/index.ts`)

```typescript
import express, { Application } from 'express';
import cors from 'cors';
import dotenv from 'dotenv';
import { handleKakaoWebhook } from './handlers';

dotenv.config();

const app: Application = express();
const PORT = process.env.PORT || 8081;

app.use(cors());
app.use(express.json());

// Health Check
app.get('/health', (req, res) => {
  res.json({ success: true, message: 'Chatbot server is running' });
});

// ì¹´ì¹´ì˜¤ ì›¹í›… ì—”ë“œí¬ì¸íŠ¸
app.post('/webhook', handleKakaoWebhook);

app.listen(PORT, () => {
  console.log(`ğŸ¤– Chatbot server running on port ${PORT}`);
});

export default app;
```

#### 2. ì›¹í›… í•¸ë“¤ëŸ¬ (`chatbot/src/handlers/index.ts`)

```typescript
import { Request, Response } from 'express';
import { KakaoRequest, KakaoResponse } from '../types/kakao';
import { getNextMatch, getRecentMatches } from './matchHandler';
import { getMyStats, getLeaderboard } from './statsHandler';
import { getNotices } from './noticeHandler';
import { getHelp } from './helpHandler';

export async function handleKakaoWebhook(req: Request, res: Response) {
  try {
    const kakaoReq: KakaoRequest = req.body;
    const userRequest = kakaoReq.userRequest;
    const utterance = userRequest.utterance; // ì‚¬ìš©ìê°€ ì…ë ¥í•œ í…ìŠ¤íŠ¸
    const action = kakaoReq.action;

    let response: KakaoResponse;

    // ì¸í…íŠ¸ë³„ ì²˜ë¦¬
    switch (action.name) {
      case 'ë‹¤ìŒê²½ê¸°ì¡°íšŒ':
        response = await getNextMatch();
        break;

      case 'ìµœê·¼ê²½ê¸°ì¡°íšŒ':
        response = await getRecentMatches();
        break;

      case 'ë‚´í†µê³„ì¡°íšŒ':
        const userId = userRequest.user.id;
        response = await getMyStats(userId);
        break;

      case 'ìˆœìœ„ì¡°íšŒ':
        const category = action.params?.category || 'goals';
        response = await getLeaderboard(category);
        break;

      case 'ê³µì§€ì‚¬í•­ì¡°íšŒ':
        response = await getNotices();
        break;

      case 'ë„ì›€ë§':
        response = getHelp();
        break;

      default:
        response = {
          version: '2.0',
          template: {
            outputs: [
              {
                simpleText: {
                  text: 'ì£„ì†¡í•©ë‹ˆë‹¤. ì´í•´í•˜ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.\n"ë„ì›€ë§"ì„ ì…ë ¥í•´ë³´ì„¸ìš”.',
                },
              },
            ],
          },
        };
    }

    res.json(response);
  } catch (error) {
    console.error('Webhook error:', error);
    res.json({
      version: '2.0',
      template: {
        outputs: [
          {
            simpleText: {
              text: 'ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.',
            },
          },
        ],
      },
    });
  }
}
```

#### 3. ê²½ê¸° í•¸ë“¤ëŸ¬ (`chatbot/src/handlers/matchHandler.ts`)

```typescript
import { KakaoResponse } from '../types/kakao';
import { callBackendAPI } from '../services/apiService';
import { formatDate, formatMatchCard } from '../utils/formatter';

export async function getNextMatch(): Promise<KakaoResponse> {
  try {
    const matches = await callBackendAPI('/api/matches?status=scheduled');

    if (matches.length === 0) {
      return {
        version: '2.0',
        template: {
          outputs: [
            {
              simpleText: {
                text: 'ì˜ˆì •ëœ ê²½ê¸°ê°€ ì—†ìŠµë‹ˆë‹¤.',
              },
            },
          ],
        },
      };
    }

    const nextMatch = matches[0];
    const matchDate = new Date(nextMatch.date);

    return {
      version: '2.0',
      template: {
        outputs: [
          {
            basicCard: {
              title: `âš½ ${nextMatch.title || 'ë‹¤ìŒ ê²½ê¸°'}`,
              description: `ğŸ“… ${formatDate(matchDate)}\nğŸ“ ${nextMatch.location || 'ë¯¸ì •'}\n\nì¶œì„ ì²´í¬ëŠ” ì•±ì—ì„œ í•´ì£¼ì„¸ìš”!`,
              buttons: [
                {
                  action: 'webLink',
                  label: 'ì•±ì—ì„œ ë³´ê¸°',
                  webLinkUrl: 'https://your-app-link.com',
                },
              ],
            },
          },
        ],
      },
    };
  } catch (error) {
    console.error('Error fetching next match:', error);
    throw error;
  }
}

export async function getRecentMatches(): Promise<KakaoResponse> {
  try {
    const matches = await callBackendAPI('/api/matches?status=completed&limit=3');

    if (matches.length === 0) {
      return {
        version: '2.0',
        template: {
          outputs: [
            {
              simpleText: {
                text: 'ìµœê·¼ ê²½ê¸° ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.',
              },
            },
          ],
        },
      };
    }

    const matchCards = matches.map((match: any) => {
      const matchDate = new Date(match.date);
      return {
        title: `${formatDate(matchDate)} ${match.title || 'ê²½ê¸°'}`,
        description: `ğŸ† AíŒ€ ${match.scoreA} : ${match.scoreB} BíŒ€\nğŸ“ ${match.location || 'ë¯¸ì •'}`,
        buttons: [
          {
            action: 'block',
            label: 'ìƒì„¸ë³´ê¸°',
            blockId: 'match_detail_block_id', // ì˜¤í”ˆë¹Œë”ì—ì„œ ì„¤ì •
            extra: {
              matchId: match.id,
            },
          },
        ],
      };
    });

    return {
      version: '2.0',
      template: {
        outputs: [
          {
            carousel: {
              type: 'basicCard',
              items: matchCards.slice(0, 3), // ìµœëŒ€ 3ê°œ
            },
          },
        ],
      },
    };
  } catch (error) {
    console.error('Error fetching recent matches:', error);
    throw error;
  }
}
```

#### 4. í†µê³„ í•¸ë“¤ëŸ¬ (`chatbot/src/handlers/statsHandler.ts`)

```typescript
import { KakaoResponse } from '../types/kakao';
import { callBackendAPI } from '../services/apiService';

export async function getMyStats(kakaoUserId: string): Promise<KakaoResponse> {
  try {
    // ì¹´ì¹´ì˜¤ ìœ ì € IDë¥¼ íšŒì› IDë¡œ ë§¤í•‘ (ì‚¬ì „ì— ì—°ë™ í•„ìš”)
    const memberId = await getMemberIdByKakaoId(kakaoUserId);

    if (!memberId) {
      return {
        version: '2.0',
        template: {
          outputs: [
            {
              simpleText: {
                text: 'íšŒì› ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.\nì•±ì—ì„œ ì¹´ì¹´ì˜¤í†¡ ì—°ë™ì„ í•´ì£¼ì„¸ìš”.',
              },
            },
          ],
        },
      };
    }

    const stats = await callBackendAPI(`/api/statistics/${memberId}`);

    return {
      version: '2.0',
      template: {
        outputs: [
          {
            basicCard: {
              title: `ğŸ“Š ${stats.memberName}ë‹˜ì˜ í†µê³„`,
              description: 
                `âš½ ê³¨: ${stats.totalGoals}ê°œ\n` +
                `ğŸ¯ ì–´ì‹œìŠ¤íŠ¸: ${stats.totalAssists}ê°œ\n` +
                `âœ… ì¶œì„ë¥ : ${stats.attendanceRate.toFixed(1)}%\n` +
                `ğŸ”¥ ìŠ¹ë¥ : ${stats.winRate.toFixed(1)}%\n` +
                `ğŸ“Š ê²½ê¸°: ${stats.totalMatches}ê²½ê¸°\n` +
                `   ìŠ¹: ${stats.totalWins} | ë¬´: ${stats.totalDraws} | íŒ¨: ${stats.totalLosses}`,
              buttons: [
                {
                  action: 'webLink',
                  label: 'ìì„¸íˆ ë³´ê¸°',
                  webLinkUrl: 'https://your-app-link.com/stats',
                },
              ],
            },
          },
        ],
      },
    };
  } catch (error) {
    console.error('Error fetching stats:', error);
    throw error;
  }
}

export async function getLeaderboard(category: string): Promise<KakaoResponse> {
  try {
    const leaderboard = await callBackendAPI(
      `/api/statistics/leaderboard?category=${category}&limit=5`
    );

    const categoryName = {
      goals: 'âš½ ë“ì ì™•',
      assists: 'ğŸ¯ ë„ì›€ì™•',
      attendance: 'âœ… ì¶œì„ì™•',
      winRate: 'ğŸ”¥ ìŠ¹ë¥ ì™•',
    }[category] || 'ìˆœìœ„';

    let text = `${categoryName}\n\n`;

    leaderboard.leaderboard.forEach((player: any, index: number) => {
      const medal = ['ğŸ¥‡', 'ğŸ¥ˆ', 'ğŸ¥‰'][index] || `${index + 1}.`;
      text += `${medal} ${player.memberName} - ${player.value}\n`;
    });

    return {
      version: '2.0',
      template: {
        outputs: [
          {
            simpleText: {
              text,
            },
          },
        ],
        quickReplies: [
          {
            action: 'block',
            label: 'ë“ì ì™•',
            blockId: 'leaderboard_block_id',
            extra: { category: 'goals' },
          },
          {
            action: 'block',
            label: 'ë„ì›€ì™•',
            blockId: 'leaderboard_block_id',
            extra: { category: 'assists' },
          },
          {
            action: 'block',
            label: 'ì¶œì„ì™•',
            blockId: 'leaderboard_block_id',
            extra: { category: 'attendance' },
          },
        ],
      },
    };
  } catch (error) {
    console.error('Error fetching leaderboard:', error);
    throw error;
  }
}

// ì¹´ì¹´ì˜¤ ìœ ì € IDë¥¼ íšŒì› IDë¡œ ë§¤í•‘
async function getMemberIdByKakaoId(kakaoUserId: string): Promise<string | null> {
  // TODO: Firestoreì— kakaoUserId -> memberId ë§¤í•‘ í…Œì´ë¸” êµ¬ì¶•
  // ì˜ˆì‹œ: members ì»¬ë ‰ì…˜ì— kakaoUserId í•„ë“œ ì¶”ê°€
  try {
    const response = await callBackendAPI(`/api/members?kakaoUserId=${kakaoUserId}`);
    return response[0]?.id || null;
  } catch {
    return null;
  }
}
```

#### 5. API ì„œë¹„ìŠ¤ (`chatbot/src/services/apiService.ts`)

```typescript
import axios from 'axios';

const BACKEND_URL = process.env.BACKEND_API_URL || 'https://your-backend.run.app';
const API_TOKEN = process.env.BACKEND_API_TOKEN; // ì„œë²„ ê°„ ì¸ì¦ìš©

export async function callBackendAPI(endpoint: string): Promise<any> {
  try {
    const response = await axios.get(`${BACKEND_URL}${endpoint}`, {
      headers: {
        Authorization: `Bearer ${API_TOKEN}`,
      },
      timeout: 5000,
    });

    return response.data.data;
  } catch (error) {
    console.error('Backend API call failed:', error);
    throw new Error('Failed to fetch data from backend');
  }
}
```

#### 6. íƒ€ì… ì •ì˜ (`chatbot/src/types/kakao.ts`)

```typescript
export interface KakaoRequest {
  bot: {
    id: string;
    name: string;
  };
  intent: {
    id: string;
    name: string;
  };
  action: {
    name: string;
    clientExtra?: any;
    params?: Record<string, any>;
    detailParams?: Record<string, any>;
  };
  userRequest: {
    timezone: string;
    params: {
      ignoreMe?: string;
    };
    block: {
      id: string;
      name: string;
    };
    utterance: string;
    lang?: string;
    user: {
      id: string;
      type: string;
      properties?: Record<string, any>;
    };
  };
}

export interface KakaoResponse {
  version: string;
  template: {
    outputs: Array<
      | { simpleText: { text: string } }
      | { simpleImage: { imageUrl: string; altText: string } }
      | { basicCard: BasicCard }
      | { carousel: Carousel }
    >;
    quickReplies?: QuickReply[];
  };
}

interface BasicCard {
  title?: string;
  description?: string;
  thumbnail?: {
    imageUrl: string;
  };
  buttons?: Button[];
}

interface Carousel {
  type: 'basicCard' | 'commerceCard';
  items: BasicCard[];
}

interface Button {
  action: 'webLink' | 'block' | 'share' | 'message';
  label: string;
  webLinkUrl?: string;
  blockId?: string;
  messageText?: string;
  extra?: any;
}

interface QuickReply {
  action: 'block' | 'message';
  label: string;
  messageText?: string;
  blockId?: string;
  extra?: any;
}
```

#### 7. `package.json`

```json
{
  "name": "soccer-chatbot",
  "version": "1.0.0",
  "description": "Soccer Match Manager Kakao Chatbot",
  "main": "dist/index.js",
  "scripts": {
    "dev": "nodemon src/index.ts",
    "build": "tsc",
    "start": "node dist/index.js"
  },
  "dependencies": {
    "express": "^4.18.2",
    "cors": "^2.8.5",
    "dotenv": "^16.3.1",
    "axios": "^1.6.0"
  },
  "devDependencies": {
    "@types/express": "^4.17.21",
    "@types/cors": "^2.8.17",
    "@types/node": "^20.10.6",
    "typescript": "^5.3.3",
    "nodemon": "^3.0.2",
    "ts-node": "^10.9.2"
  }
}
```

---

## ğŸ­ ì‹œë‚˜ë¦¬ì˜¤ êµ¬ì„± (ì¹´ì¹´ì˜¤ i ì˜¤í”ˆë¹Œë”)

### 1. ë¸”ë¡ ë§Œë“¤ê¸°

#### ì‹œì‘ ë¸”ë¡
```
ì‚¬ìš©ì: (ì‹œì‘)
ë´‡: ì•ˆë…•í•˜ì„¸ìš”! ì¶•êµ¬íŒ€ ë§¤ë‹ˆì € ë´‡ì…ë‹ˆë‹¤ âš½

ë¬´ì—‡ì„ ë„ì™€ë“œë¦´ê¹Œìš”?

[ë‹¤ìŒ ê²½ê¸°] [ìµœê·¼ ê²½ê¸°] [ë‚´ í†µê³„] [ìˆœìœ„]
```

#### ë‹¤ìŒ ê²½ê¸° ì¡°íšŒ ë¸”ë¡
```
ë°œí™” ì˜ˆì‹œ:
- ë‹¤ìŒ ê²½ê¸°
- ë‹¤ìŒ ê²½ê¸° ì–¸ì œì•¼
- ë‹¤ìŒ ê²½ê¸° ì¼ì •
- ê²½ê¸° ì–¸ì œ

ìŠ¤í‚¬: webhook â†’ /webhook (ì•¡ì…˜: ë‹¤ìŒê²½ê¸°ì¡°íšŒ)
```

#### ìµœê·¼ ê²½ê¸° ì¡°íšŒ ë¸”ë¡
```
ë°œí™” ì˜ˆì‹œ:
- ìµœê·¼ ê²½ê¸°
- ì§€ë‚œ ê²½ê¸°
- ê²½ê¸° ê²°ê³¼
- ìµœê·¼ ê²°ê³¼

ìŠ¤í‚¬: webhook â†’ /webhook (ì•¡ì…˜: ìµœê·¼ê²½ê¸°ì¡°íšŒ)
```

#### ë‚´ í†µê³„ ì¡°íšŒ ë¸”ë¡
```
ë°œí™” ì˜ˆì‹œ:
- ë‚´ í†µê³„
- ë‚´ ê¸°ë¡
- ë‚´ ìˆœìœ„

ìŠ¤í‚¬: webhook â†’ /webhook (ì•¡ì…˜: ë‚´í†µê³„ì¡°íšŒ)
```

#### ìˆœìœ„ ì¡°íšŒ ë¸”ë¡
```
ë°œí™” ì˜ˆì‹œ:
- ìˆœìœ„
- ë­í‚¹
- ë“ì ì™•
- ë„ì›€ì™•

ìŠ¤í‚¬: webhook â†’ /webhook (ì•¡ì…˜: ìˆœìœ„ì¡°íšŒ)
íŒŒë¼ë¯¸í„°: category (goals/assists/attendance/winRate)
```

### 2. í´ë°± ë¸”ë¡ (Fallback)

```
ì‚¬ìš©ì: (ì¸ì‹ ë¶ˆê°€)
ë´‡: ì£„ì†¡í•©ë‹ˆë‹¤. ì´í•´í•˜ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.

ë‹¤ìŒ ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•´ë³´ì„¸ìš”:
â€¢ ë‹¤ìŒ ê²½ê¸°
â€¢ ìµœê·¼ ê²½ê¸°
â€¢ ë‚´ í†µê³„
â€¢ ìˆœìœ„

[ë„ì›€ë§]
```

---

## ğŸš€ ë°°í¬ ë° í…ŒìŠ¤íŠ¸

### 1. ì±—ë´‡ ì„œë²„ ë°°í¬

```bash
cd chatbot

# Docker ì´ë¯¸ì§€ ë¹Œë“œ & Cloud Run ë°°í¬
gcloud run deploy soccer-chatbot \
  --source . \
  --platform managed \
  --region asia-northeast3 \
  --allow-unauthenticated \
  --set-env-vars "BACKEND_API_URL=https://your-backend.run.app"

# ë°°í¬ ì™„ë£Œ í›„ URL í™•ì¸
# ì˜ˆ: https://soccer-chatbot-xxxxx.run.app
```

### 2. ì¹´ì¹´ì˜¤ ì˜¤í”ˆë¹Œë” ìŠ¤í‚¬ ë“±ë¡

1. **ì˜¤í”ˆë¹Œë” > ìŠ¤í‚¬**
2. **ìƒˆ ìŠ¤í‚¬ ë§Œë“¤ê¸°**
   - ì´ë¦„: `ë‹¤ìŒê²½ê¸°ì¡°íšŒ`
   - URL: `https://soccer-chatbot-xxxxx.run.app/webhook`
   - Method: POST
3. **íŒŒë¼ë¯¸í„° ì„¤ì •** (í•„ìš”ì‹œ)
4. **ì €ì¥**

### 3. í…ŒìŠ¤íŠ¸

1. **ì˜¤í”ˆë¹Œë”ì—ì„œ í…ŒìŠ¤íŠ¸**
   - ìš°ì¸¡ "ë´‡ í…ŒìŠ¤íŠ¸" íŒ¨ë„ì—ì„œ í…ŒìŠ¤íŠ¸

2. **ì¹´ì¹´ì˜¤í†¡ì—ì„œ í…ŒìŠ¤íŠ¸**
   - ì¹´ì¹´ì˜¤í†¡ > ê²€ìƒ‰ > `@soccer_manager` ê²€ìƒ‰
   - ì±„íŒ… ì‹œì‘
   - "ë‹¤ìŒ ê²½ê¸°" ì…ë ¥

---

## ğŸ’¡ ê³ ê¸‰ ê¸°ëŠ¥

### 1. ì¶œì„ ì²´í¬ (ë²„íŠ¼ ì¸í„°ë™ì…˜)

```typescript
// ë‹¤ìŒ ê²½ê¸°ì— ì¶œì„ ì²´í¬ ë²„íŠ¼ ì¶”ê°€
{
  basicCard: {
    title: "ë‹¤ìŒ ê²½ê¸°",
    description: "1ì›” 8ì¼ (ìˆ˜) 15:00\nì„œìš¸ ìš´ë™ì¥",
    buttons: [
      {
        action: 'block',
        label: 'âœ… ì¶œì„í• ê²Œìš”',
        blockId: 'attendance_confirm_block',
        extra: {
          matchId: 'match123',
          status: 'present'
        }
      },
      {
        action: 'block',
        label: 'âŒ ë¶ˆì°¸í• ê²Œìš”',
        blockId: 'attendance_confirm_block',
        extra: {
          matchId: 'match123',
          status: 'absent'
        }
      }
    ]
  }
}
```

### 2. ì•Œë¦¼ ë°œì†¡ (í”„ë¡œì•¡í‹°ë¸Œ ë©”ì‹œì§€)

ê²½ê¸° ë“±ë¡ ì‹œ ìë™ìœ¼ë¡œ ì¹´ì¹´ì˜¤í†¡ ì•Œë¦¼ ë°œì†¡:

```typescript
// backend/src/services/notificationService.ts
import axios from 'axios';

async function sendKakaoNotification(userIds: string[], message: string) {
  // ì¹´ì¹´ì˜¤ ì•Œë¦¼í†¡ API ì‚¬ìš©
  // https://developers.kakao.com/docs/latest/ko/message/rest-api
  
  for (const userId of userIds) {
    try {
      await axios.post('https://kapi.kakao.com/v2/api/talk/memo/default/send', {
        template_object: {
          object_type: 'text',
          text: message,
          link: {
            web_url: 'https://your-app.com',
            mobile_web_url: 'https://your-app.com'
          }
        }
      }, {
        headers: {
          'Authorization': `Bearer ${KAKAO_ACCESS_TOKEN}`
        }
      });
    } catch (error) {
      console.error('Failed to send Kakao notification:', error);
    }
  }
}
```

### 3. ì¹´ì¹´ì˜¤í†¡ ë¡œê·¸ì¸ ì—°ë™

ëª¨ë°”ì¼ ì•±ì—ì„œ ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸:

```typescript
// mobile/src/screens/LoginScreen.tsx
import * as AuthSession from 'expo-auth-session';

async function loginWithKakao() {
  const redirectUri = AuthSession.makeRedirectUri();
  const result = await AuthSession.startAsync({
    authUrl: `https://kauth.kakao.com/oauth/authorize?client_id=${KAKAO_APP_KEY}&redirect_uri=${redirectUri}&response_type=code`,
  });

  if (result.type === 'success') {
    const { code } = result.params;
    // ë°±ì—”ë“œë¡œ code ì „ì†¡ â†’ ì¹´ì¹´ì˜¤ ID ì—°ë™
  }
}
```

---

## ğŸ“Š ì‚¬ìš© ì˜ˆì‹œ

### ëŒ€í™” ì˜ˆì‹œ 1: ê²½ê¸° ì¡°íšŒ

```
ì‚¬ìš©ì: ë‹¤ìŒ ê²½ê¸° ì–¸ì œì•¼?

ë´‡: âš½ ì •ê¸° ê²½ê¸°
ğŸ“… 1ì›” 8ì¼ (ìˆ˜) 15:00
ğŸ“ ì„œìš¸ ìš´ë™ì¥

ì¶œì„ ì²´í¬ëŠ” ì•±ì—ì„œ í•´ì£¼ì„¸ìš”!

[ì•±ì—ì„œ ë³´ê¸°]
```

### ëŒ€í™” ì˜ˆì‹œ 2: í†µê³„ ì¡°íšŒ

```
ì‚¬ìš©ì: ë‚´ í†µê³„

ë´‡: ğŸ“Š í™ê¸¸ë™ë‹˜ì˜ í†µê³„

âš½ ê³¨: 12ê°œ
ğŸ¯ ì–´ì‹œìŠ¤íŠ¸: 5ê°œ
âœ… ì¶œì„ë¥ : 95.5%
ğŸ”¥ ìŠ¹ë¥ : 68.2%
ğŸ“Š ê²½ê¸°: 22ê²½ê¸°
   ìŠ¹: 15 | ë¬´: 5 | íŒ¨: 2

[ìì„¸íˆ ë³´ê¸°]
```

### ëŒ€í™” ì˜ˆì‹œ 3: ìˆœìœ„ ì¡°íšŒ

```
ì‚¬ìš©ì: ë“ì ì™• ëˆ„êµ¬ì•¼?

ë´‡: âš½ ë“ì ì™•

ğŸ¥‡ í™ê¸¸ë™ - 12ê³¨
ğŸ¥ˆ ê¹€ì² ìˆ˜ - 8ê³¨
ğŸ¥‰ ë°•ì˜í¬ - 7ê³¨
4. ì´ë¯¼ì¤€ - 5ê³¨
5. ìµœìˆ˜ì§„ - 3ê³¨

[ë“ì ì™•] [ë„ì›€ì™•] [ì¶œì„ì™•]
```

---

## ğŸ” ë³´ì•ˆ ê³ ë ¤ì‚¬í•­

### 1. ì›¹í›… ê²€ì¦

```typescript
// ì¹´ì¹´ì˜¤ì—ì„œ ì˜¨ ìš”ì²­ì¸ì§€ í™•ì¸
function verifyKakaoRequest(req: Request): boolean {
  const signature = req.headers['x-kakao-signature'];
  // HMAC ê²€ì¦ ë¡œì§
  return true;
}
```

### 2. ì‚¬ìš©ì ì¸ì¦

```typescript
// ë¯¼ê°í•œ ì •ë³´ëŠ” ì¸ì¦ í›„ì—ë§Œ ì œê³µ
if (!isUserAuthenticated(kakaoUserId)) {
  return {
    simpleText: {
      text: 'ë¨¼ì € ì•±ì—ì„œ ì¹´ì¹´ì˜¤í†¡ ì—°ë™ì„ í•´ì£¼ì„¸ìš”.'
    }
  };
}
```

---

## ğŸ’° ë¹„ìš©

- **ì¹´ì¹´ì˜¤ ì±„ë„**: ë¬´ë£Œ
- **ì¹´ì¹´ì˜¤ i ì˜¤í”ˆë¹Œë”**: ë¬´ë£Œ (ì›” 1000ê±´)
- **ì±—ë´‡ ì„œë²„ (Cloud Run)**: ë¬´ë£Œ í• ë‹¹ëŸ‰ ë‚´ ì‚¬ìš© ê°€ëŠ¥
- **ì¹´ì¹´ì˜¤ ì•Œë¦¼í†¡**: ìœ ë£Œ (ê±´ë‹¹ ~8ì›)

---

## ğŸ¯ ë‹¤ìŒ ë‹¨ê³„

1. âœ… ì±—ë´‡ ì„œë²„ êµ¬ì¶•
2. âœ… ê¸°ë³¸ ëŒ€í™” ì‹œë‚˜ë¦¬ì˜¤ êµ¬ì„±
3. ğŸ”„ ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ ì—°ë™
4. ğŸ”„ ì¶œì„ ì²´í¬ ê¸°ëŠ¥ ì¶”ê°€
5. ğŸ”„ ì•Œë¦¼í†¡ ë°œì†¡ ê¸°ëŠ¥
6. ğŸ”„ ìì—°ì–´ ì²˜ë¦¬ ê°œì„ 

---

**ì¹´ì¹´ì˜¤í†¡ ì±—ë´‡ìœ¼ë¡œ ë” í¸ë¦¬í•œ íŒ€ ê´€ë¦¬ë¥¼! âš½ğŸ’¬**








